<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>8 Марта - Викторина | Algonova</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        /* ========== RESET & BASE ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #0a0a1a;
            min-height: 100vh;
            font-family: 'Press Start 2P', cursive;
            color: #fff;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1000px;
            min-height: 100vh;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        /* ========== BACKGROUND ========== */
        .game-bg {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url('assets/bg-arena.jpg') center center / cover no-repeat;
            z-index: 0;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .game-bg.visible { opacity: 1; }

        .game-bg-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.35);
            z-index: 1;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }

        .game-bg-overlay.visible { opacity: 1; }

        /* ========== FLOATING PETALS ========== */
        #particles {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 2;
        }

        .petal {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #e91e63;
            border-radius: 50% 0 50% 50%;
            opacity: 0.4;
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% { transform: translateY(-20px) rotate(0deg); opacity: 0.4; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* ========== SHARED ========== */
        .screen {
            min-height: 100vh;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 10;
            position: relative;
        }

        .screen.active { display: flex; }

        .pixel-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 11px;
            padding: 14px 28px;
            background: linear-gradient(to bottom, #e91e63, #c2185b);
            border: 3px solid #f48fb1;
            color: #fff;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.15s;
            box-shadow: 0 4px 0 #880e4f;
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .pixel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #880e4f;
            filter: brightness(1.1);
        }

        .pixel-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #880e4f;
        }

        .pixel-btn.secondary {
            background: linear-gradient(to bottom, #37474f, #263238);
            border-color: #607d8b;
            box-shadow: 0 4px 0 #1a2327;
        }

        .pixel-btn.secondary:hover { box-shadow: 0 6px 0 #1a2327; }
        .pixel-btn.secondary:active { box-shadow: 0 2px 0 #1a2327; }

        .lang-toggle {
            position: fixed;
            top: 12px;
            right: 16px;
            z-index: 1000;
            display: flex;
            gap: 0;
            border: 2px solid #555;
            border-radius: 4px;
            overflow: hidden;
        }

        .lang-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 9px;
            padding: 6px 10px;
            background: #1a1a2a;
            border: none;
            color: #888;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lang-btn.active {
            background: #e91e63;
            color: #fff;
        }

        .back-btn {
            position: absolute;
            top: 16px;
            left: 16px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            padding: 8px 14px;
            background: rgba(0,0,0,0.5);
            border: 2px solid #555;
            color: #888;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            z-index: 50;
        }

        .back-btn:hover { border-color: #e91e63; color: #e91e63; }

        /* ========== WELCOME SCREEN ========== */
        #welcomeScreen {
            background: url('assets/bg-welcome.jpg') center center / cover no-repeat;
            text-align: center;
            overflow: hidden;
            /* Break out of game-container to go full-width */
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 100;
        }

        .welcome-particles {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 1;
        }

        .welcome-content {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .welcome-eight {
            font-size: 120px;
            color: transparent;
            line-height: 1;
            margin-bottom: 8px;
        }

        .welcome-title {
            font-size: 22px;
            color: transparent;
            margin-bottom: 8px;
        }

        .welcome-subtitle {
            font-size: 10px;
            color: transparent;
            margin-bottom: 40px;
            letter-spacing: 2px;
        }

        .welcome-desc {
            font-size: 9px;
            color: transparent;
            max-width: 500px;
            line-height: 2;
            margin-bottom: 30px;
        }

        /* Animated sparkle star */
        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 0 6px 2px rgba(200, 180, 255, 0.6);
            animation: twinkle ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.3); }
        }

        /* Floating galaxy swirl */
        .galaxy-swirl {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(150, 100, 255, 0.3) 0%, transparent 70%);
            animation: float-drift linear infinite;
            pointer-events: none;
        }

        @keyframes float-drift {
            0% { transform: translate(0, 0) rotate(0deg) scale(1); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translate(var(--dx), var(--dy)) rotate(360deg) scale(0.5); opacity: 0; }
        }

        /* Shooting star */
        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #fff;
            border-radius: 50%;
            animation: shoot linear infinite;
        }

        .shooting-star::after {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 40px;
            height: 1px;
            background: linear-gradient(to left, rgba(255,255,255,0.8), transparent);
            transform-origin: left center;
            transform: rotate(var(--angle));
        }

        @keyframes shoot {
            0% { transform: translate(0, 0); opacity: 0; }
            5% { opacity: 1; }
            30% { opacity: 1; }
            50% { transform: translate(var(--sx), var(--sy)); opacity: 0; }
            100% { opacity: 0; }
        }

        /* Glow pulse for button on welcome */
        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 4px 0 #880e4f, 0 0 20px rgba(233, 30, 99, 0.3); }
            50% { box-shadow: 0 4px 0 #880e4f, 0 0 40px rgba(233, 30, 99, 0.6), 0 0 80px rgba(233, 30, 99, 0.2); }
        }

        #welcomeScreen .pixel-btn {
            position: absolute;
            bottom: 28%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            background: transparent;
            border: none;
            box-shadow: none;
            color: transparent;
            padding: 30px 120px;
            cursor: pointer;
        }

        #welcomeScreen .pixel-btn:hover {
            box-shadow: none;
            filter: brightness(1.3);
            transform: translateX(-50%) scale(1.05);
        }

        #welcomeScreen .pixel-btn:active {
            box-shadow: none;
            transform: translateX(-50%) scale(0.97);
        }

        /* ========== CHARACTER SELECT ========== */
        #charSelectScreen {
            justify-content: flex-start;
            padding-top: 60px;
            background: radial-gradient(ellipse at center, #1a0a1f 0%, #0a0a0f 70%);
        }

        .char-select-title {
            font-size: 16px;
            color: #f8bbd0;
            text-shadow: 0 0 15px #e91e6355;
            margin-bottom: 20px;
        }

        .char-search {
            width: 100%;
            max-width: 400px;
            padding: 10px 16px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            background: #1a1a2a;
            border: 2px solid #555;
            border-radius: 4px;
            color: #fff;
            margin-bottom: 20px;
            text-align: center;
            transition: border-color 0.2s;
        }

        .char-search:focus { outline: none; border-color: #e91e63; }
        .char-search::placeholder { color: #555; }

        .char-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
            width: 100%;
            max-height: 65vh;
            overflow-y: auto;
            padding: 10px 4px;
            scrollbar-width: thin;
            scrollbar-color: #e91e63 #1a1a2a;
        }

        .char-grid::-webkit-scrollbar { width: 6px; }
        .char-grid::-webkit-scrollbar-track { background: #1a1a2a; border-radius: 3px; }
        .char-grid::-webkit-scrollbar-thumb { background: #e91e63; border-radius: 3px; }

        .char-card {
            background: #12121f;
            border: 3px solid #333;
            border-radius: 10px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .char-card:hover {
            border-color: #e91e63;
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.3);
        }

        .char-card .char-avatar {
            width: 120px;
            height: 150px;
            margin: 0 auto 10px;
            overflow: hidden;
            border-radius: 6px;
        }

        .char-card .char-avatar img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .char-card-name {
            font-size: 10px;
            color: #ffeb3b;
            text-shadow: 0 0 10px #ffeb3b44;
        }

        .no-results {
            font-size: 10px;
            color: #555;
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
        }

        /* ========== OUTFIT SELECT ========== */
        #outfitScreen {
            justify-content: flex-end;
            padding: 10px 20px 0;
        }

        .outfit-layout {
            display: flex;
            align-items: flex-end;
            gap: 20px;
            width: 100%;
            max-width: 900px;
            justify-content: center;
            flex: 1;
        }

        .outfit-preview {
            flex-shrink: 0;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }

        .outfit-preview-img {
            width: 350px;
            height: 500px;
            object-fit: contain;
            object-position: bottom center;
            filter: drop-shadow(0 0 20px rgba(233, 30, 99, 0.3));
            transition: all 0.3s;
        }

        .outfit-preview-name {
            font-size: 14px;
            color: #ffeb3b;
            text-shadow: 0 0 15px #ffeb3b55;
            margin-top: 4px;
            margin-bottom: 8px;
        }

        .outfit-panel {
            background: rgba(12, 12, 30, 0.8);
            border: 3px solid #555;
            border-radius: 12px;
            padding: 20px 16px;
            max-width: 340px;
        }

        .outfit-panel-title {
            font-size: 12px;
            color: #fff;
            text-align: center;
            margin-bottom: 16px;
            letter-spacing: 1px;
        }

        .outfit-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }

        .outfit-card {
            background: #1a1a2e;
            border: 3px solid #444;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            overflow: hidden;
        }

        .outfit-card:hover {
            border-color: #e91e63;
            transform: scale(1.03);
        }

        .outfit-card.selected {
            border-color: #4caf50;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }

        .outfit-card-img-wrap {
            width: 100%;
            height: 120px;
            overflow: hidden;
        }

        .outfit-card-img-wrap img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top center;
        }

        .outfit-card-label {
            font-size: 7px;
            color: #fff;
            line-height: 1.4;
            padding: 6px 4px;
            background: rgba(0,0,0,0.3);
        }

        .outfit-select-btn {
            display: block;
            width: 100%;
            font-size: 12px;
            padding: 14px;
        }

        /* ========== QUIZ SCREEN ========== */
        #quizScreen {
            justify-content: flex-start;
            padding: 12px 16px;
        }

        .quiz-top {
            width: 100%;
            text-align: center;
            margin-bottom: 8px;
        }

        .quiz-timer-label {
            font-size: 8px;
            color: #ce93d8;
            margin-bottom: 4px;
            text-shadow: 0 0 10px #9c27b044;
        }

        .quiz-timer-display {
            font-size: 28px;
            color: #fff;
            text-shadow: 0 0 20px rgba(255,255,255,0.3);
            background: rgba(0, 0, 0, 0.6);
            display: inline-block;
            padding: 8px 20px;
            border: 3px solid #555;
            border-radius: 8px;
            min-width: 140px;
            letter-spacing: 4px;
            transition: color 0.3s;
        }

        .quiz-timer-display.warning { color: #ffc107; border-color: #ffc107; }
        .quiz-timer-display.critical {
            color: #f44336;
            border-color: #f44336;
            animation: timer-pulse 0.5s ease-in-out infinite;
        }

        @keyframes timer-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .quiz-progress-bar {
            width: 100%;
            max-width: 500px;
            margin: 8px auto;
            display: flex;
            gap: 4px;
            justify-content: center;
        }

        .quiz-progress-dot {
            width: 16px;
            height: 6px;
            background: #333;
            border-radius: 3px;
            transition: background 0.3s;
        }

        .quiz-progress-dot.done { background: #4caf50; }
        .quiz-progress-dot.wrong { background: #f44336; }
        .quiz-progress-dot.current { background: #ffeb3b; animation: dot-pulse 1s infinite; }

        @keyframes dot-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        #quizScreen {
            align-items: center;
            justify-content: flex-start;
            padding: 12px 30px 20px;
        }

        .quiz-panel {
            background: rgba(12, 12, 30, 0.85);
            border: 3px solid #555;
            border-radius: 12px;
            padding: 20px 16px;
            width: 340px;
            align-self: flex-end;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .quiz-question-card {
            background: rgba(20, 20, 40, 0.7);
            border-radius: 8px;
            padding: 16px 14px;
            text-align: center;
        }

        .quiz-question-num {
            font-size: 8px;
            color: #9c27b0;
            margin-bottom: 8px;
        }

        .quiz-question-text {
            font-size: 11px;
            line-height: 2;
            color: #fff;
        }

        .quiz-answers {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }

        .quiz-answer-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 9px;
            padding: 12px 14px;
            background: rgba(40, 40, 60, 0.9);
            border: 2px solid #555;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
            line-height: 1.6;
        }

        .quiz-answer-btn:hover:not(.disabled) {
            border-color: #e91e63;
            background: rgba(50, 30, 50, 0.9);
        }

        .quiz-answer-btn.disabled { cursor: default; pointer-events: none; }

        .quiz-answer-btn .num {
            font-size: 14px;
            font-weight: bold;
            min-width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            flex-shrink: 0;
            background: #333;
            color: #fff;
        }

        .quiz-answer-btn:nth-child(1) .num { background: #c62828; }
        .quiz-answer-btn:nth-child(2) .num { background: #1565c0; }
        .quiz-answer-btn:nth-child(3) .num { background: #2e7d32; }

        .quiz-answer-btn.correct,
        .quiz-answer-btn.selected {
            border-color: #e91e63;
            background: rgba(58, 20, 40, 0.9);
            box-shadow: 0 0 20px rgba(233, 30, 99, 0.4);
        }

        .quiz-answer-btn.wrong {
            border-color: #f44336;
            background: rgba(58, 26, 26, 0.9);
            box-shadow: 0 0 20px rgba(244, 67, 54, 0.3);
            animation: shake 0.4s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-6px); }
            40% { transform: translateX(6px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }

        .quiz-answer-btn .answer-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
        }

        .quiz-feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 64px;
            z-index: 100;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            text-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .quiz-feedback.show { transform: translate(-50%, -50%) scale(1); }

        .quiz-score-display {
            font-size: 10px;
            color: #ffeb3b;
            text-align: center;
            margin-top: 8px;
        }

        /* ========== RESULTS SCREEN ========== */
        #resultsScreen {
            text-align: center;
            overflow: hidden;
            position: relative;
        }

        .results-queen-title {
            font-size: 28px;
            color: #ff69b4;
            text-shadow: 0 0 30px #ff69b4, 0 0 60px #e91e63, 0 0 90px #ff1493;
            margin-bottom: 10px;
            animation: queen-glow 2s ease-in-out infinite;
            position: relative;
            z-index: 2;
        }

        @keyframes queen-glow {
            0%, 100% { text-shadow: 0 0 30px #ff69b4, 0 0 60px #e91e63, 0 0 90px #ff1493; transform: scale(1); }
            50% { text-shadow: 0 0 50px #ff69b4, 0 0 80px #e91e63, 0 0 120px #ff1493; transform: scale(1.05); }
        }

        .results-flowers {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 1;
        }

        .results-flower {
            position: absolute;
            font-size: 24px;
            animation: flower-float 4s ease-in-out infinite;
            opacity: 0.8;
        }

        @keyframes flower-float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
            50% { transform: translateY(-15px) rotate(15deg); opacity: 1; }
        }

        .results-avatar {
            width: 250px;
            height: 350px;
            margin-bottom: 16px;
            filter: drop-shadow(0 0 40px rgba(255, 105, 180, 0.5));
            animation: avatar-entrance 1s cubic-bezier(0.34, 1.56, 0.64, 1) both;
            position: relative;
            z-index: 2;
        }

        @keyframes avatar-entrance {
            0% { transform: scale(0) rotate(-10deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .results-avatar img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            animation: avatar-float 3s ease-in-out infinite;
        }

        @keyframes avatar-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .results-name {
            font-size: 14px;
            color: #ffeb3b;
            margin-bottom: 12px;
            position: relative;
            z-index: 2;
        }

        .results-score-big { display: none; }
        .results-score-label { display: none; }
        .results-points { display: none; }

        .results-message {
            font-size: 11px;
            color: #f8bbd0;
            line-height: 2.2;
            max-width: 500px;
            margin-bottom: 12px;
            position: relative;
            z-index: 2;
        }

        .results-greeting {
            font-size: 9px;
            color: #ce93d8;
            line-height: 2;
            max-width: 450px;
            margin-bottom: 20px;
            padding: 16px;
            border: 2px solid #ff69b444;
            border-radius: 8px;
            background: rgba(26, 26, 42, 0.6);
            position: relative;
            z-index: 2;
        }

        .results-btns {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .results-download-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #e91e63, #ff69b4);
            border: 3px solid #ff69b4;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            text-shadow: 1px 1px 0 rgba(0,0,0,0.3);
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.4);
            transition: all 0.2s;
        }

        .results-download-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 105, 180, 0.6);
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            z-index: 200;
            pointer-events: none;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(-10px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 700px) {
            .welcome-eight { font-size: 60px; }
            .welcome-title { font-size: 14px; }
            .welcome-desc { font-size: 8px; max-width: 90%; }

            .char-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }
            .char-card .char-avatar { width: 90px; height: 110px; }
            .char-card-name { font-size: 8px; }

            .outfit-layout { flex-direction: column; gap: 10px; align-items: center; }
            .outfit-preview-img { width: 200px; height: 280px; }
            .outfit-panel { max-width: 100%; }
            .outfit-card-img-wrap { height: 80px; }

            #quizScreen { padding: 20px 10px; }
            .quiz-panel { width: 100%; max-width: 100%; align-self: center; }
            .quiz-answer-btn { font-size: 8px; padding: 10px 12px; }
            .quiz-question-text { font-size: 9px; }

            .results-score-big { font-size: 36px; }
            .results-avatar { width: 180px; height: 250px; }
            .results-queen-title { font-size: 20px; }

            .pixel-btn { font-size: 9px; padding: 10px 18px; }
            .back-btn { font-size: 8px; padding: 6px 10px; }
        }

        @media (max-width: 400px) {
            .outfit-grid { gap: 8px; }
            .outfit-card-img-wrap { height: 60px; }
            .outfit-card-label { font-size: 6px; }
            .quiz-timer-display { font-size: 20px; padding: 6px 14px; }
        }
    </style>
</head>
<body>
    <!-- Floating petals -->
    <div id="particles"></div>

    <!-- Game background (shown on outfit/quiz/results screens) -->
    <div class="game-bg" id="gameBg"></div>
    <div class="game-bg-overlay" id="gameBgOverlay"></div>

    <!-- Language toggle -->
    <div class="lang-toggle">
        <button class="lang-btn active" data-lang="ru" onclick="setLang('ru')">RU</button>
        <button class="lang-btn" data-lang="en" onclick="setLang('en')">EN</button>
    </div>

    <div class="game-container" id="game">

        <!-- ===== SCREEN: Welcome ===== -->
        <div class="screen active" id="welcomeScreen">
            <div class="welcome-particles" id="welcomeParticles"></div>
            <div class="welcome-content">
                <div class="welcome-eight">8</div>
                <div class="welcome-title" data-i18n="welcomeTitle">МАРТА</div>
                <div class="welcome-subtitle">ALGONOVA QUIZ</div>
                <div class="welcome-desc" data-i18n="welcomeDesc">
                    Выбери своего персонажа, выбери образ и пройди весёлую викторину!
                </div>
            </div>
            <button class="pixel-btn" onclick="showScreen('charSelectScreen')" data-i18n="startBtn">НАЧАТЬ</button>
        </div>

        <!-- ===== SCREEN: Character Select ===== -->
        <div class="screen" id="charSelectScreen">
            <button class="back-btn" onclick="showScreen('welcomeScreen')">&#8592;</button>
            <div class="char-select-title" data-i18n="selectCharTitle">ВЫБЕРИ ПЕРСОНАЖА</div>
            <input type="text" class="char-search" id="charSearch"
                   data-i18n-placeholder="searchPlaceholder"
                   placeholder="Поиск по имени..."
                   oninput="filterCharacters(this.value)">
            <div class="char-grid" id="charGrid"></div>
        </div>

        <!-- ===== SCREEN: Outfit Select ===== -->
        <div class="screen" id="outfitScreen">
            <button class="back-btn" onclick="showScreen('charSelectScreen')">&#8592;</button>
            <div class="outfit-layout">
                <div class="outfit-preview">
                    <img class="outfit-preview-img" id="outfitPreviewImg" src="" alt="">
                    <div class="outfit-preview-name" id="outfitPreviewName"></div>
                </div>
                <div class="outfit-panel">
                    <div class="outfit-panel-title" data-i18n="selectOutfitTitle">ВЫБЕРИ СВОЙ ОБРАЗ</div>
                    <div class="outfit-grid" id="outfitGrid"></div>
                    <button class="pixel-btn outfit-select-btn" onclick="startQuiz()" data-i18n="selectBtn">ВЫБРАТЬ</button>
                </div>
            </div>
        </div>

        <!-- ===== SCREEN: Quiz ===== -->
        <div class="screen" id="quizScreen">
            <div class="quiz-top">
                <div class="quiz-timer-label" data-i18n="timerLabel">ЧАСИКИ ТИКАЮТ</div>
                <div class="quiz-timer-display" id="quizTimerDisplay">00:30</div>
                <div class="quiz-progress-bar" id="quizProgressBar"></div>
            </div>
            <!-- Hidden elements for JS compatibility -->
            <img id="quizCharImg" src="" alt="" style="display:none">
            <div id="quizCharName" style="display:none"></div>
            <div id="quizScoreDisplay" style="display:none"></div>
            <div class="quiz-panel">
                <div class="quiz-question-card">
                    <div class="quiz-question-num" id="quizQuestionNum"></div>
                    <div class="quiz-question-text" id="quizQuestionText"></div>
                </div>
                <div class="quiz-answers" id="quizAnswers"></div>
            </div>
            <div class="quiz-feedback" id="quizFeedback"></div>
        </div>

        <!-- ===== SCREEN: Results ===== -->
        <div class="screen" id="resultsScreen">
            <div class="results-flowers" id="resultsFlowers"></div>
            <div class="results-queen-title" id="resultsQueenTitle">Ты королева!</div>
            <div class="results-avatar" id="resultsAvatar"></div>
            <div class="results-name" id="resultsName"></div>
            <div class="results-score-big" id="resultsScoreBig"></div>
            <div class="results-score-label" data-i18n="correctAnswers">правильных ответов</div>
            <div class="results-points" id="resultsPoints"></div>
            <div class="results-message" id="resultsMessage"></div>
            <div class="results-greeting" id="resultsGreeting"></div>
            <div class="results-btns">
                <button class="results-download-btn" onclick="downloadResultImage()" id="downloadResultBtn">СКАЧАТЬ</button>
                <button class="pixel-btn" onclick="playAgain()" data-i18n="playAgainBtn">ИГРАТЬ ЕЩЁ</button>
                <button class="pixel-btn secondary" onclick="showScreen('welcomeScreen')" data-i18n="menuBtn">МЕНЮ</button>
            </div>
        </div>
    </div>

    <script>
    // ==================== CONFIGURATION ====================
    const CONFIG = {
        questionTime: 30,
        totalQuestions: 15,
        basePoints: 100,
        speedBonusMax: 50,
    };

    // ==================== i18n ====================
    let currentLang = 'ru';

    const TEXTS = {
        ru: {
            welcomeTitle: 'МАРТА',
            welcomeDesc: 'Выбери своего персонажа, выбери образ и пройди весёлую викторину!',
            startBtn: 'НАЧАТЬ',
            selectCharTitle: 'ВЫБЕРИ ПЕРСОНАЖА',
            searchPlaceholder: 'Поиск по имени...',
            selectOutfitTitle: 'ВЫБЕРИ СВОЙ ОБРАЗ',
            selectBtn: 'ВЫБРАТЬ',
            timerLabel: 'ЧАСИКИ ТИКАЮТ',
            correctAnswers: 'правильных ответов',
            playAgainBtn: 'ИГРАТЬ ЕЩЁ',
            menuBtn: 'МЕНЮ',
            noResults: 'Персонаж не найден',
            timeUp: 'Время вышло!',
            points: 'очков',
            questionNum: 'ВОПРОС',
            score: 'Счёт',
            resultMsg15: 'Невероятно! Ты просто гений!',
            resultMsg12: 'Великолепно! Почти идеально!',
            resultMsg8: 'Отличный результат! Так держать!',
            resultMsg4: 'Хорошая попытка! Ты молодец!',
            resultMsg0: 'Не переживай! Ты всё равно лучшая!',
            greeting: 'Поздравляем с 8 Марта! Желаем счастья, вдохновения, любви и ярких моментов в каждом дне!',
        },
        en: {
            welcomeTitle: 'MARCH',
            welcomeDesc: 'Choose your character, pick an outfit and complete a fun quiz!',
            startBtn: 'START',
            selectCharTitle: 'CHOOSE CHARACTER',
            searchPlaceholder: 'Search by name...',
            selectOutfitTitle: 'CHOOSE YOUR LOOK',
            selectBtn: 'SELECT',
            timerLabel: 'CLOCK IS TICKING',
            correctAnswers: 'correct answers',
            playAgainBtn: 'PLAY AGAIN',
            menuBtn: 'MENU',
            noResults: 'Character not found',
            timeUp: 'Time is up!',
            points: 'points',
            questionNum: 'QUESTION',
            score: 'Score',
            resultMsg15: "Incredible! You're a genius!",
            resultMsg12: 'Wonderful! Almost perfect!',
            resultMsg8: 'Great result! Keep it up!',
            resultMsg4: 'Nice try! You did well!',
            resultMsg0: "Don't worry! You're still the best!",
            greeting: "Happy Women's Day! Wishing you happiness, inspiration, love and bright moments every day!",
        }
    };

    function t(key) { return TEXTS[currentLang][key] || key; }

    function setLang(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.lang === lang);
        });
        document.documentElement.lang = lang;
        applyI18n();
    }

    function applyI18n() {
        document.querySelectorAll('[data-i18n]').forEach(el => {
            el.textContent = t(el.dataset.i18n);
        });
        document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
            el.placeholder = t(el.dataset.i18nPlaceholder);
        });
        if (document.getElementById('charSelectScreen').classList.contains('active')) {
            renderCharacters();
        }
        if (document.getElementById('outfitScreen').classList.contains('active') && gameState.selectedChar) {
            renderOutfits(gameState.selectedChar);
        }
        if (document.getElementById('quizScreen').classList.contains('active') && gameState.currentQuestion >= 0) {
            renderCurrentQuestion();
        }
        if (document.getElementById('resultsScreen').classList.contains('active')) {
            renderResults();
        }
    }

    // ==================== CHARACTER DATA ====================
    const CHARACTERS = [
        {
            id: 1,
            name: { ru: 'Армиша', en: 'Armisha' },
            outfits: [
                { image: 'assets/characters/armisha_archer.png', card: 'assets/characters/armisha_archer.png', label: { ru: 'Лучница', en: 'Archer' } },
                { image: 'assets/characters/armisha_dj.png', card: 'assets/characters/armisha_dj.png', label: { ru: 'DJ', en: 'DJ' } },
                { image: 'assets/characters/armisha_reader.png', card: 'assets/characters/armisha_reader.png', label: { ru: 'Книжница', en: 'Reader' } },
            ],
        },
        {
            id: 2,
            name: { ru: 'Ира', en: 'Ira' },
            outfits: [
                { image: 'assets/characters/ira_crafter.png', card: 'assets/characters/ira_crafter.png', label: { ru: 'Художник', en: 'Crafter' } },
                { image: 'assets/characters/ira_stylist.png', card: 'assets/characters/ira_stylist.png', label: { ru: 'Стилист', en: 'Stylist' } },
                { image: 'assets/characters/ira_sommelier.png', card: 'assets/characters/ira_sommelier.png', label: { ru: 'Сомелье', en: 'Sommelier' } },
            ],
        },
        {
            id: 3,
            name: { ru: 'Влада', en: 'Vlada' },
            outfits: [
                { image: 'assets/characters/vlada_samurai.png', card: 'assets/characters/vlada_samurai.png', label: { ru: 'Самурай', en: 'Samurai' } },
                { image: 'assets/characters/vlada_astronaut.png', card: 'assets/characters/vlada_astronaut.png', label: { ru: 'Космонавт', en: 'Astronaut' } },
                { image: 'assets/characters/vlada_crafter.png', card: 'assets/characters/vlada_crafter.png', label: { ru: 'Крафтер', en: 'Crafter' } },
            ],
        },
    ];

    // ==================== QUESTION DATA ====================
    // 15 humorous questions — 3 options each, correct: index (0-2)
    const QUESTIONS = [
        {
            text: {
                ru: 'В каком виде спорта у женщин есть абсолютное преимущество?',
                en: 'In which sport do women have an absolute advantage?'
            },
            options: [
                { text: { ru: 'Синхронное плавание', en: 'Synchronized swimming' } },
                { text: { ru: 'Шахматы — ферзь ходит как хочет', en: 'Chess — the queen moves as she pleases' } },
                { text: { ru: 'Кёрлинг', en: 'Curling' } },
            ],
            correct: 1,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Какой день по статистике — любимый день женщины?',
                en: 'What day is statistically a woman\'s favorite?'
            },
            options: [
                { text: { ru: '8 Марта', en: 'March 8' } },
                { text: { ru: '3 Сентября', en: 'September 3' } },
                { text: { ru: '29 Февраля', en: 'February 29' } },
            ],
            correct: 0,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Когда вы слышите слово «Стартер», о чём вы думаете?',
                en: 'When you hear the word "Starter", what comes to mind?'
            },
            options: [
                { text: { ru: 'Блюдо перед основным', en: 'A dish before the main course' } },
                { text: { ru: 'Деталь двигателя', en: 'An engine part' } },
                { text: { ru: 'Набор для начинающих', en: 'A beginner\'s kit' } },
            ],
            correct: 0,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Сколько пар обуви достаточно для женщины?',
                en: 'How many pairs of shoes are enough for a woman?'
            },
            options: [
                { text: { ru: '10', en: '10' } },
                { text: { ru: '25', en: '25' } },
                { text: { ru: 'Такого числа не существует', en: 'Such a number doesn\'t exist' } },
            ],
            correct: 2,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Что женщина имеет в виду, говоря «Мне нечего надеть»?',
                en: 'What does a woman mean by "I have nothing to wear"?'
            },
            options: [
                { text: { ru: 'Шкаф пуст', en: 'The closet is empty' } },
                { text: { ru: 'Нет ничего нового', en: 'Nothing new to wear' } },
                { text: { ru: 'Нет настроения выбирать', en: 'Not in the mood to choose' } },
            ],
            correct: 1,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Какой суперсилой хотели бы обладать большинство женщин?',
                en: 'What superpower would most women want?'
            },
            options: [
                { text: { ru: 'Летать', en: 'Flying' } },
                { text: { ru: 'Читать мысли мужчин', en: 'Reading men\'s thoughts' } },
                { text: { ru: 'Останавливать время перед дедлайном', en: 'Stopping time before deadlines' } },
            ],
            correct: 2,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Что происходит, когда женщина говорит «Я не голодная»?',
                en: 'What happens when a woman says "I\'m not hungry"?'
            },
            options: [
                { text: { ru: 'Она действительно не голодная', en: 'She\'s really not hungry' } },
                { text: { ru: 'Она съест половину твоей порции', en: 'She\'ll eat half of your portion' } },
                { text: { ru: 'Она закажет отдельно через 10 минут', en: 'She\'ll order separately in 10 minutes' } },
            ],
            correct: 1,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Какой цветок является символом 8 Марта в России?',
                en: 'Which flower is the symbol of March 8 in Russia?'
            },
            options: [
                { text: { ru: 'Роза', en: 'Rose' } },
                { text: { ru: 'Мимоза', en: 'Mimosa' } },
                { text: { ru: 'Тюльпан', en: 'Tulip' } },
            ],
            correct: 1,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Сколько времени женщине нужно, чтобы «быстро собраться»?',
                en: 'How long does a woman need to "get ready quickly"?'
            },
            options: [
                { text: { ru: '15 минут', en: '15 minutes' } },
                { text: { ru: '45 минут', en: '45 minutes' } },
                { text: { ru: '«Быстро» — понятие относительное', en: '"Quickly" is a relative concept' } },
            ],
            correct: 2,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Что значит «Делай как хочешь» от женщины?',
                en: 'What does "Do whatever you want" from a woman mean?'
            },
            options: [
                { text: { ru: 'Полная свобода действий', en: 'Total freedom of action' } },
                { text: { ru: 'Тест на правильный ответ', en: 'A test for the right answer' } },
                { text: { ru: 'Ловушка без правильного ответа', en: 'A trap with no right answer' } },
            ],
            correct: 2,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Кто стал первой женщиной в космосе?',
                en: 'Who was the first woman in space?'
            },
            options: [
                { text: { ru: 'Валентина Терешкова', en: 'Valentina Tereshkova' } },
                { text: { ru: 'Салли Райд', en: 'Sally Ride' } },
                { text: { ru: 'Светлана Савицкая', en: 'Svetlana Savitskaya' } },
            ],
            correct: 0,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Почему женщины живут дольше мужчин?',
                en: 'Why do women live longer than men?'
            },
            options: [
                { text: { ru: 'Здоровое питание', en: 'Healthy eating' } },
                { text: { ru: 'Не делают глупостей на спор', en: 'They don\'t do stupid things on a dare' } },
                { text: { ru: 'Генетика', en: 'Genetics' } },
            ],
            correct: 1,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Сколько раз за день женщина смотрит в зеркало?',
                en: 'How many times a day does a woman look in the mirror?'
            },
            options: [
                { text: { ru: '5-10 раз', en: '5-10 times' } },
                { text: { ru: '20-30 раз', en: '20-30 times' } },
                { text: { ru: 'Каждая отражающая поверхность — зеркало', en: 'Every reflective surface is a mirror' } },
            ],
            correct: 2,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Какая фраза мужчины вызывает максимальное подозрение?',
                en: 'Which phrase from a man causes maximum suspicion?'
            },
            options: [
                { text: { ru: '«Я на работе задержусь»', en: '"I\'ll be late at work"' } },
                { text: { ru: '«Телефон разрядился»', en: '"My phone died"' } },
                { text: { ru: 'Обе фразы одинаково подозрительны', en: 'Both phrases are equally suspicious' } },
            ],
            correct: 2,
            timeLimit: 30,
        },
        {
            text: {
                ru: 'Какой самый правильный ответ на вопрос «Я поправилась?»',
                en: 'What is the best answer to "Did I gain weight?"'
            },
            options: [
                { text: { ru: '«Нет, ты прекрасна!»', en: '"No, you\'re beautiful!"' } },
                { text: { ru: '«Немного»', en: '"A little"' } },
                { text: { ru: 'Притвориться, что не слышишь', en: 'Pretend you didn\'t hear' } },
            ],
            correct: 0,
            timeLimit: 30,
        },
    ];

    // ==================== GAME STATE ====================
    let gameState = {
        selectedChar: null,
        selectedOutfit: 0,
        currentQuestion: -1,
        score: 0,
        correctCount: 0,
        timerInterval: null,
        timeRemaining: 0,
        isAnswered: false,
        shuffledQuestions: [],
        answers: [], // track correct/wrong per question
    };

    // ==================== SCREEN MANAGEMENT ====================
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');

        // Show/hide game background
        const showBg = ['outfitScreen', 'quizScreen', 'resultsScreen'].includes(screenId);
        document.getElementById('gameBg').classList.toggle('visible', showBg);
        document.getElementById('gameBgOverlay').classList.toggle('visible', showBg);

        if (screenId === 'charSelectScreen') {
            renderCharacters();
            const search = document.getElementById('charSearch');
            search.value = '';
            setTimeout(() => search.focus(), 300);
        }
    }

    // ==================== CHARACTER SELECT ====================
    function renderCharacters(filter = '') {
        const grid = document.getElementById('charGrid');
        const lowerFilter = filter.toLowerCase().trim();

        const filtered = CHARACTERS.filter(c => {
            const name = c.name[currentLang] || c.name.ru;
            return name.toLowerCase().includes(lowerFilter);
        });

        if (filtered.length === 0) {
            grid.innerHTML = `<div class="no-results">${t('noResults')}</div>`;
            return;
        }

        grid.innerHTML = filtered.map(c => {
            const name = c.name[currentLang] || c.name.ru;
            const imgSrc = c.outfits[0].card;
            return `
                <div class="char-card" onclick="selectCharacter(${c.id})">
                    <div class="char-avatar">
                        <img src="${imgSrc}" alt="${name}">
                    </div>
                    <div class="char-card-name">${name}</div>
                </div>
            `;
        }).join('');
    }

    function filterCharacters(value) {
        renderCharacters(value);
    }

    function selectCharacter(charId) {
        const char = CHARACTERS.find(c => c.id === charId);
        if (!char) return;
        gameState.selectedChar = char;
        gameState.selectedOutfit = 0;
        showScreen('outfitScreen');
        renderOutfits(char);
    }

    // ==================== OUTFIT SELECT ====================
    function renderOutfits(char) {
        const name = char.name[currentLang] || char.name.ru;
        const outfit = char.outfits[gameState.selectedOutfit];

        // Preview image
        document.getElementById('outfitPreviewImg').src = outfit.image;
        document.getElementById('outfitPreviewName').textContent = name;

        // Outfit grid
        const grid = document.getElementById('outfitGrid');
        grid.innerHTML = char.outfits.map((o, i) => {
            const label = o.label[currentLang] || o.label.ru;
            const selected = gameState.selectedOutfit === i;
            return `
                <div class="outfit-card ${selected ? 'selected' : ''}" onclick="selectOutfit(${i})">
                    <div class="outfit-card-img-wrap"><img src="${o.image}" alt="${label}"></div>
                    <div class="outfit-card-label">${label}</div>
                </div>
            `;
        }).join('');
    }

    function selectOutfit(idx) {
        gameState.selectedOutfit = idx;
        renderOutfits(gameState.selectedChar);
    }

    // ==================== QUIZ ENGINE ====================
    function startQuiz() {
        gameState.shuffledQuestions = shuffleArray([...QUESTIONS]).slice(0, CONFIG.totalQuestions);
        gameState.currentQuestion = 0;
        gameState.score = 0;
        gameState.correctCount = 0;
        gameState.isAnswered = false;
        gameState.answers = [];

        showScreen('quizScreen');
        renderQuizCharacter();
        renderProgressBar();
        showQuestion(0);
    }

    function renderQuizCharacter() {
        const char = gameState.selectedChar;
        const outfit = char.outfits[gameState.selectedOutfit];
        document.getElementById('quizCharImg').src = outfit.image;
        document.getElementById('quizCharName').textContent = char.name[currentLang] || char.name.ru;
    }

    function renderProgressBar() {
        const bar = document.getElementById('quizProgressBar');
        const total = gameState.shuffledQuestions.length;
        bar.innerHTML = Array.from({ length: total }, (_, i) => {
            let cls = '';
            if (i < gameState.answers.length) {
                cls = gameState.answers[i] ? 'done' : 'wrong';
            } else if (i === gameState.currentQuestion) {
                cls = 'current';
            }
            return `<div class="quiz-progress-dot ${cls}"></div>`;
        }).join('');
    }

    function showQuestion(index) {
        if (index >= gameState.shuffledQuestions.length) {
            endQuiz();
            return;
        }

        gameState.currentQuestion = index;
        gameState.isAnswered = false;
        renderCurrentQuestion();
        renderProgressBar();
        startTimer(gameState.shuffledQuestions[index].timeLimit || CONFIG.questionTime);
    }

    function renderCurrentQuestion() {
        const q = gameState.shuffledQuestions[gameState.currentQuestion];
        if (!q) return;

        document.getElementById('quizQuestionNum').textContent =
            `${t('questionNum')} ${gameState.currentQuestion + 1}/${gameState.shuffledQuestions.length}`;

        document.getElementById('quizQuestionText').textContent =
            q.text[currentLang] || q.text.ru;

        document.getElementById('quizScoreDisplay').textContent =
            `${t('score')}: ${gameState.score}`;

        const answersEl = document.getElementById('quizAnswers');
        answersEl.innerHTML = q.options.map((opt, i) => {
            const text = opt.text ? (opt.text[currentLang] || opt.text.ru) : '';
            const imgHtml = opt.image
                ? `<img class="answer-img" src="${opt.image}" alt="">`
                : '';

            return `
                <button class="quiz-answer-btn ${gameState.isAnswered ? 'disabled' : ''}"
                        onclick="selectAnswer(${i})">
                    <span class="num">${i + 1}</span>
                    ${imgHtml}
                    <span>${text}</span>
                </button>
            `;
        }).join('');
    }

    function formatTime(seconds) {
        const m = String(Math.floor(seconds / 60)).padStart(2, '0');
        const s = String(seconds % 60).padStart(2, '0');
        return `${m}:${s}`;
    }

    function startTimer(seconds) {
        clearInterval(gameState.timerInterval);

        const display = document.getElementById('quizTimerDisplay');
        gameState.timeRemaining = seconds;
        display.textContent = formatTime(seconds);
        display.className = 'quiz-timer-display';

        gameState.timerInterval = setInterval(() => {
            gameState.timeRemaining--;
            display.textContent = formatTime(Math.max(0, gameState.timeRemaining));

            if (gameState.timeRemaining <= 5) {
                display.className = 'quiz-timer-display critical';
            } else if (gameState.timeRemaining <= 10) {
                display.className = 'quiz-timer-display warning';
            }

            if (gameState.timeRemaining <= 0) {
                clearInterval(gameState.timerInterval);
                if (!gameState.isAnswered) {
                    timeUp();
                }
            }
        }, 1000);
    }

    function selectAnswer(index) {
        if (gameState.isAnswered) return;
        gameState.isAnswered = true;
        clearInterval(gameState.timerInterval);

        const q = gameState.shuffledQuestions[gameState.currentQuestion];
        const buttons = document.querySelectorAll('.quiz-answer-btn');

        buttons.forEach(btn => btn.classList.add('disabled'));
        buttons[index].classList.add('selected');

        const timeBonus = Math.round((gameState.timeRemaining / (q.timeLimit || CONFIG.questionTime)) * CONFIG.speedBonusMax);
        gameState.score += CONFIG.basePoints + timeBonus;
        gameState.correctCount++;
        gameState.answers.push(true);

        renderProgressBar();
        document.getElementById('quizScoreDisplay').textContent = `${t('score')}: ${gameState.score}`;

        setTimeout(() => {
            showQuestion(gameState.currentQuestion + 1);
        }, 1200);
    }

    function timeUp() {
        gameState.isAnswered = true;
        const buttons = document.querySelectorAll('.quiz-answer-btn');

        buttons.forEach(btn => btn.classList.add('disabled'));
        gameState.correctCount++;
        gameState.answers.push(true);

        renderProgressBar();

        setTimeout(() => {
            showQuestion(gameState.currentQuestion + 1);
        }, 1200);
    }

    function showFeedback(emoji) {
        const fb = document.getElementById('quizFeedback');
        fb.textContent = emoji;
        fb.classList.add('show');
        setTimeout(() => fb.classList.remove('show'), 800);
    }

    function endQuiz() {
        clearInterval(gameState.timerInterval);
        showScreen('resultsScreen');
        renderResults();
        spawnConfetti();
    }

    // ==================== RESULTS ====================
    function renderResults() {
        const char = gameState.selectedChar;
        const name = char.name[currentLang] || char.name.ru;
        const outfit = char.outfits[gameState.selectedOutfit];

        document.getElementById('resultsAvatar').innerHTML = `<img src="${outfit.image}" alt="${name}">`;
        document.getElementById('resultsName').textContent = name;

        document.getElementById('resultsMessage').textContent = t('greeting');
        document.getElementById('resultsGreeting').textContent = '';

        // Spawn flower decorations
        const flowers = ['🌸', '🌺', '🌷', '🌹', '💐', '🌻', '🪻', '💮', '🏵'];
        const flowersContainer = document.getElementById('resultsFlowers');
        flowersContainer.innerHTML = '';
        for (let i = 0; i < 20; i++) {
            const f = document.createElement('span');
            f.className = 'results-flower';
            f.textContent = flowers[Math.floor(Math.random() * flowers.length)];
            f.style.left = Math.random() * 90 + 5 + '%';
            f.style.top = Math.random() * 90 + 5 + '%';
            f.style.animationDelay = (Math.random() * 3) + 's';
            f.style.animationDuration = (3 + Math.random() * 3) + 's';
            f.style.fontSize = (18 + Math.random() * 20) + 'px';
            flowersContainer.appendChild(f);
        }
    }

    function downloadResultImage() {
        const outfit = gameState.selectedChar.outfits[gameState.selectedOutfit];
        const link = document.createElement('a');
        link.href = outfit.image;
        link.download = 'queen-' + gameState.selectedChar.name.ru + '.png';
        link.click();
    }

    function playAgain() {
        showScreen('charSelectScreen');
    }

    // ==================== CONFETTI ====================
    function spawnConfetti() {
        const colors = ['#e91e63', '#9c27b0', '#ffeb3b', '#4caf50', '#2196f3', '#ff9800', '#f48fb1'];
        for (let i = 0; i < 60; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.top = '-10px';
            confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.width = (4 + Math.random() * 8) + 'px';
            confetti.style.height = (4 + Math.random() * 8) + 'px';
            confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
            confetti.style.animation = `confetti-fall ${2 + Math.random() * 3}s linear ${Math.random() * 2}s forwards`;
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 6000);
        }
    }

    // ==================== FLOATING PETALS ====================
    function initPetals() {
        const container = document.getElementById('particles');
        const colors = ['#e91e63', '#f48fb1', '#ce93d8', '#ffcdd2', '#f8bbd0'];
        for (let i = 0; i < 15; i++) {
            const petal = document.createElement('div');
            petal.className = 'petal';
            petal.style.left = Math.random() * 100 + 'vw';
            petal.style.animationDuration = (6 + Math.random() * 10) + 's';
            petal.style.animationDelay = Math.random() * 10 + 's';
            petal.style.width = (4 + Math.random() * 6) + 'px';
            petal.style.height = (4 + Math.random() * 6) + 'px';
            petal.style.background = colors[Math.floor(Math.random() * colors.length)];
            petal.style.opacity = 0.2 + Math.random() * 0.3;
            container.appendChild(petal);
        }
    }

    // ==================== WELCOME SCREEN ANIMATIONS ====================
    function initWelcomeParticles() {
        const container = document.getElementById('welcomeParticles');
        if (!container) return;

        // Twinkling stars
        for (let i = 0; i < 40; i++) {
            const star = document.createElement('div');
            star.className = 'sparkle';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDuration = (1.5 + Math.random() * 3) + 's';
            star.style.animationDelay = Math.random() * 4 + 's';
            const size = 2 + Math.random() * 4;
            star.style.width = size + 'px';
            star.style.height = size + 'px';
            const colors = ['rgba(200,180,255,0.6)', 'rgba(255,200,240,0.5)', 'rgba(150,200,255,0.5)', 'rgba(255,255,255,0.7)'];
            star.style.boxShadow = '0 0 ' + (4 + size) + 'px 2px ' + colors[Math.floor(Math.random() * colors.length)];
            container.appendChild(star);
        }

        // Floating galaxy swirls
        for (let i = 0; i < 6; i++) {
            const swirl = document.createElement('div');
            swirl.className = 'galaxy-swirl';
            swirl.style.left = Math.random() * 100 + '%';
            swirl.style.top = Math.random() * 100 + '%';
            const swirlSize = 20 + Math.random() * 40;
            swirl.style.width = swirlSize + 'px';
            swirl.style.height = swirlSize + 'px';
            swirl.style.setProperty('--dx', (Math.random() * 200 - 100) + 'px');
            swirl.style.setProperty('--dy', (Math.random() * 200 - 100) + 'px');
            swirl.style.animationDuration = (15 + Math.random() * 20) + 's';
            swirl.style.animationDelay = Math.random() * 10 + 's';
            const swirlColors = [
                'radial-gradient(circle, rgba(150,100,255,0.3) 0%, transparent 70%)',
                'radial-gradient(circle, rgba(233,30,99,0.2) 0%, transparent 70%)',
                'radial-gradient(circle, rgba(100,180,255,0.2) 0%, transparent 70%)'
            ];
            swirl.style.background = swirlColors[Math.floor(Math.random() * swirlColors.length)];
            container.appendChild(swirl);
        }

        // Shooting stars
        for (let i = 0; i < 3; i++) {
            const shootStar = document.createElement('div');
            shootStar.className = 'shooting-star';
            shootStar.style.left = (10 + Math.random() * 60) + '%';
            shootStar.style.top = (5 + Math.random() * 40) + '%';
            const angle = 20 + Math.random() * 30;
            shootStar.style.setProperty('--angle', angle + 'deg');
            shootStar.style.setProperty('--sx', (150 + Math.random() * 200) + 'px');
            shootStar.style.setProperty('--sy', (80 + Math.random() * 100) + 'px');
            shootStar.style.animationDuration = (6 + Math.random() * 8) + 's';
            shootStar.style.animationDelay = (i * 4 + Math.random() * 3) + 's';
            container.appendChild(shootStar);
        }
    }

    // ==================== UTILS ====================
    function shuffleArray(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    // ==================== INIT ====================
    document.addEventListener('DOMContentLoaded', () => {
        initPetals();
        initWelcomeParticles();
        applyI18n();
    });
    </script>
</body>
</html>
